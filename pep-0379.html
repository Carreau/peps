<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <title>PEP 379 -- Adding an Assignment Expression</title>
  <link rel="STYLESHEET" href="style.css" type="text/css" />
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="../" title="Python Home Page">
<img src="../pics/PyBanner049.gif" alt="[Python]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="../">Python Home</a></b>]
[<b><a href=".">PEP Index</a></b>]
[<b><a href="pep-0379.txt">PEP Source</a></b>]
</td></tr></table>
<div class="header">
<table border="0">
  <tr><th>PEP:&nbsp;</th><td>379</td></tr>
  <tr><th>Title:&nbsp;</th><td>Adding an Assignment Expression</td></tr>
  <tr><th>Version:&nbsp;</th><td>$Revision$</td></tr>
  <tr><th>Last-Modified:&nbsp;</th><td><a href="https://hg.python.org/peps/file/tip/pep-0379.txt">$Date$</a> </td></tr>
  <tr><th>Author:&nbsp;</th><td>Jervis Whitley &lt;jervisau&#32;&#97;t&#32;gmail.com&gt;</td></tr>
  <tr><th>Status:&nbsp;</th><td>Withdrawn</td></tr>
  <tr><th>Type:&nbsp;</th><td>Standards Track</td></tr>
  <tr><th>Content-Type:&nbsp;</th><td><a href="pep-0009.html">text/plain</a> </td></tr>
  <tr><th>Created:&nbsp;</th><td>14-Mar-2009</td></tr>
  <tr><th>Python-Version:&nbsp;</th><td>2.7, 3.2</td></tr>
  <tr><th>Post-History:&nbsp;</th><td></td></tr>
</table>
</div>
<hr />
<div class="content">
<h3>Abstract</h3>
<pre>
    This PEP adds a new assignment expression to the Python language
    to make it possible to assign the result of an expression in
    almost any place.  The new expression will allow the assignment of
    the result of an expression at first use (in a comparison for
    example).


</pre>
<h3>Motivation and Summary</h3>
<pre>
   Issue1714448 &quot;if something as x:&quot; [1] describes a feature to allow
   assignment of the result of an expression in an if statement to a
   name.  It supposed that the &#x27;as&#x27; syntax could be borrowed for this
   purpose.  Many times it is not the expression itself that is
   interesting, rather one of the terms that make up the
   expression. To be clear, something like this:
   
       if (f_result() == [1, 2, 3]) as res:

   seems awfully limited, when this:

       if (f_result() as res) == [1, 2, 3]:

   is probably the desired result. 


</pre>
<h3>Use Cases</h3>
<pre>
    See the Examples section near the end.


</pre>
<h3>Specification</h3>
<pre>
    A new expression is proposed with the (nominal) syntax:

        EXPR -&gt; VAR

    This single expression does the following:

    - Evaluate the value of EXPR, an arbitrary expression;
    - Assign the result to VAR, a single assignment target; and
    - Leave the result of EXPR on the Top of Stack (TOS)
    
    Here &#x27;-&gt;&#x27; or (RARROW) has been used to illustrate the concept that
    the result of EXPR is assigned to VAR.

    The translation of the proposed syntax is:

        VAR = (EXPR)
        (EXPR)

    The assignment target can be either an attribute, a subscript or
    name:

        f() -&gt; name[0]      # where &#x27;name&#x27; exists previously.

	f() -&gt; name.attr    # again &#x27;name&#x27; exists prior to this
	expression.

        f() -&gt; name

    This expression should be available anywhere that an expression is
    currently accepted.

    All exceptions that are currently raised during invalid
    assignments will continue to be raised when using the assignment
    expression.  For example, a NameError will be raised when in
    example 1 and 2 above if &#x27;name&#x27; is not previously defined, or an
    IndexError if index 0 was out of range.


</pre>
<h3>Examples from the Standard Library</h3>
<pre>
    The following two examples were chosen after a brief search
    through the standard library, specifically both are from ast.py
    which happened to be open at the time of the search.

    Original:

        def walk(node):
            from collections import deque
            todo = deque([node])
            while todo:
                node = todo.popleft()
                todo.extend(iter_child_nodes(node))
                yield node

    Using assignment expression:

        def walk(node):
            from collections import deque
            todo = deque([node])
            while todo:
                todo.extend(iter_child_nodes(todo.popleft() -&gt; node))
                yield node

    Original:

        def get_docstring(node, clean=True):
            if not isinstance(node, (FunctionDef, ClassDef, Module)):
                raise TypeError(&quot;%r can&#x27;t have docstrings&quot; 
                                    % node.__class__.__name__)
            if node.body and isinstance(node.body[0], Expr) and \
               isinstance(node.body[0].value, Str):
                if clean:
                    import inspect
                    return inspect.cleandoc(node.body[0].value.s)
                return node.body[0].value.s

    Using assignment expresion:

        def get_docstring(node, clean=True):
            if not isinstance(node, (FunctionDef, ClassDef, Module)):
                raise TypeError(&quot;%r can&#x27;t have docstrings&quot; 
                                    % node.__class__.__name__)
            if node.body -&gt; body and isinstance(body[0] -&gt; elem, Expr) and \
               isinstance(elem.value -&gt; value, Str):
                if clean:
                    import inspect
                    return inspect.cleandoc(value.s)
                return value.s


</pre>
<h3>Examples</h3>
<pre>
    The examples shown below highlight some of the desirable features
    of the assignment expression, and some of the possible corner
    cases.

    1. Assignment in an if statement for use later.

        def expensive():
            import time; time.sleep(1)
            return &#x27;spam&#x27;

        if expensive() -&gt; res in (&#x27;spam&#x27;, &#x27;eggs&#x27;):
            dosomething(res)

    2. Assignment in a while loop clause.

        while len(expensive() -&gt; res) == 4:
            dosomething(res)

    3. Keep the iterator object from the for loop.

        for ch in expensive() -&gt; res:
            sell_on_internet(res)

    4. Corner case.

        for ch -&gt; please_dont in expensive():
            pass
        # who would want to do this? Not I. 


</pre>
<h3>References</h3>
<pre>
    [1] Issue1714448 &quot;if something as x:&quot;, k0wax 
        <a href="http://bugs.python.org/issue1714448">http://bugs.python.org/issue1714448</a>


</pre>
<h3>Copyright</h3>
<pre>
    This document has been placed in the public domain.



</pre>
</div>
</body>
</html>
