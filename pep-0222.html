<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <title>PEP 222 -- Web Library Enhancements</title>
  <link rel="STYLESHEET" href="style.css" type="text/css" />
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="../" title="Python Home Page">
<img src="../pics/PyBanner003.gif" alt="[Python]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="../">Python Home</a></b>]
[<b><a href=".">PEP Index</a></b>]
[<b><a href="pep-0222.txt">PEP Source</a></b>]
</td></tr></table>
<div class="header">
<table border="0">
  <tr><th>PEP:&nbsp;</th><td>222</td></tr>
  <tr><th>Title:&nbsp;</th><td>Web Library Enhancements</td></tr>
  <tr><th>Version:&nbsp;</th><td>$Revision$</td></tr>
  <tr><th>Last-Modified:&nbsp;</th><td><a href="https://hg.python.org/peps/file/tip/pep-0222.txt">$Date$</a> </td></tr>
  <tr><th>Author:&nbsp;</th><td>A.M. Kuchling &lt;amk&#32;&#97;t&#32;amk.ca&gt;</td></tr>
  <tr><th>Status:&nbsp;</th><td>Deferred</td></tr>
  <tr><th>Type:&nbsp;</th><td>Standards Track</td></tr>
  <tr><th>Created:&nbsp;</th><td>18-Aug-2000</td></tr>
  <tr><th>Python-Version:&nbsp;</th><td>2.1</td></tr>
  <tr><th>Post-History:&nbsp;</th><td>22-Dec-2000</td></tr>
</table>
</div>
<hr />
<div class="content">
<h3>Abstract</h3>
<pre>
    This PEP proposes a set of enhancements to the CGI development
    facilities in the Python standard library.  Enhancements might be
    new features, new modules for tasks such as cookie support, or
    removal of obsolete code.

    The original intent was to make improvements to Python 2.1.
    However, there seemed little interest from the Python community,
    and time was lacking, so this PEP has been deferred to some future
    Python release.
    

</pre>
<h3>Open Issues</h3>
<pre>
    This section lists changes that have been suggested, but about
    which no firm decision has yet been made.  In the final version of
    this PEP, this section should be empty, as all the changes should
    be classified as accepted or rejected.

    cgi.py: We should not be told to create our own subclass just so
    we can handle file uploads. As a practical matter, I have yet to
    find the time to do this right, so I end up reading cgi.py&#x27;s temp
    file into, at best, another file. Some of our legacy code actually
    reads it into a second temp file, then into a final destination!
    And even if we did, that would mean creating yet another object
    with its __init__ call and associated overhead.

    cgi.py: Currently, query data with no `=&#x27; are ignored.  Even if
    keep_blank_values is set, queries like `...?value=&amp;...&#x27; are
    returned with blank values but queries like `...?value&amp;...&#x27; are
    completely lost.  It would be great if such data were made
    available through the FieldStorage interface, either as entries
    with None as values, or in a separate list.

    Utility function: build a query string from a list of 2-tuples

    Dictionary-related utility classes: NoKeyErrors (returns an empty
    string, never a KeyError), PartialStringSubstitution (returns 
    the original key string, never a KeyError)


    
</pre>
<h3>New Modules</h3>
<pre>
    This section lists details about entire new packages or modules
    that should be added to the Python standard library.

    * fcgi.py : A new module adding support for the FastCGI protocol.
      Robin Dunn&#x27;s code needs to be ported to Windows, though.

</pre>
<h3>Major Changes to Existing Modules</h3>
<pre>
    This section lists details of major changes to existing modules,
    whether in implementation or in interface.  The changes in this
    section therefore carry greater degrees of risk, either in
    introducing bugs or a backward incompatibility.

    The cgi.py module would be deprecated.  (XXX A new module or
    package name hasn&#x27;t been chosen yet: &#x27;web&#x27;?  &#x27;cgilib&#x27;?)

</pre>
<h3>Minor Changes to Existing Modules</h3>
<pre>
    This section lists details of minor changes to existing modules.
    These changes should have relatively small implementations, and
    have little risk of introducing incompatibilities with previous
    versions.


</pre>
<h3>Rejected Changes</h3>
<pre>
    The changes listed in this section were proposed for Python 2.1,
    but were rejected as unsuitable.  For each rejected change, a
    rationale is given describing why the change was deemed
    inappropriate.

    * An HTML generation module is not part of this PEP.  Several such
      modules exist, ranging from HTMLgen&#x27;s purely programming
      interface to ASP-inspired simple templating to DTML&#x27;s complex
      templating.  There&#x27;s no indication of which templating module to
      enshrine in the standard library, and that probably means that
      no module should be so chosen.

    * cgi.py: Allowing a combination of query data and POST data.
      This doesn&#x27;t seem to be standard at all, and therefore is
      dubious practice.

</pre>
<h3>Proposed Interface</h3>
<pre>
    XXX open issues: naming convention (studlycaps or
    underline-separated?); need to look at the cgi.parse*() functions
    and see if they can be simplified, too.

    Parsing functions: carry over most of the parse* functions from
    cgi.py
    
    # The Response class borrows most of its methods from Zope&#x27;s
    # HTTPResponse class.
    
    class Response:
        &quot;&quot;&quot;
        Attributes:
        status: HTTP status code to return
        headers: dictionary of response headers
        body: string containing the body of the HTTP response
        &quot;&quot;&quot;
        
        def __init__(self, status=200, headers={}, body=&quot;&quot;):
            pass
    
        def setStatus(self, status, reason=None):
            &quot;Set the numeric HTTP response code&quot;
            pass
    
        def setHeader(self, name, value):
            &quot;Set an HTTP header&quot;
            pass
    
        def setBody(self, body):
            &quot;Set the body of the response&quot;
            pass
    
        def setCookie(self, name, value,
                      path = &#x27;/&#x27;,  
                      comment = None, 
                      domain = None, 
                      max-age = None,
                      expires = None,
                      secure = 0
                      ):
            &quot;Set a cookie&quot;
            pass
    
        def expireCookie(self, name):
            &quot;Remove a cookie from the user&quot;
            pass
    
        def redirect(self, url):
            &quot;Redirect the browser to another URL&quot;
            pass
    
        def __str__(self):
            &quot;Convert entire response to a string&quot;
            pass
    
        def dump(self):
            &quot;Return a string representation useful for debugging&quot;
            pass
            
        # XXX methods for specific classes of error:serverError, 
        # badRequest, etc.?
    
    
    class Request:
    
        &quot;&quot;&quot;
        Attributes: 

        XXX should these be dictionaries, or dictionary-like objects?
        .headers : dictionary containing HTTP headers
        .cookies : dictionary of cookies
        .fields  : data from the form
        .env     : environment dictionary
        &quot;&quot;&quot;
        
        def __init__(self, environ=os.environ, stdin=sys.stdin,
                     keep_blank_values=1, strict_parsing=0):
            &quot;&quot;&quot;Initialize the request object, using the provided environment
            and standard input.&quot;&quot;&quot;
            pass
    
        # Should people just use the dictionaries directly?
        def getHeader(self, name, default=None):
            pass
    
        def getCookie(self, name, default=None):
            pass
    
        def getField(self, name, default=None):
            &quot;Return field&#x27;s value as a string (even if it&#x27;s an uploaded file)&quot;
            pass
            
        def getUploadedFile(self, name):
            &quot;&quot;&quot;Returns a file object that can be read to obtain the contents
            of an uploaded file.  XXX should this report an error if the 
            field isn&#x27;t actually an uploaded file?  Or should it wrap
            a StringIO around simple fields for consistency?
            &quot;&quot;&quot;
            
        def getURL(self, n=0, query_string=0):
            &quot;&quot;&quot;Return the URL of the current request, chopping off &#x27;n&#x27; path
            components from the right.  Eg. if the URL is
            &quot;<a href="http://foo.com/bar/baz/quux">http://foo.com/bar/baz/quux</a>&quot;, n=2 would return
            &quot;<a href="http://foo.com/bar">http://foo.com/bar</a>&quot;.  Does not include the query string (if
            any)
            &quot;&quot;&quot;

        def getBaseURL(self, n=0):
            &quot;&quot;&quot;Return the base URL of the current request, adding &#x27;n&#x27; path
            components to the end to recreate more of the whole URL.  
            
            Eg. if the request URL is
            &quot;<a href="http://foo.com/q/bar/baz/qux">http://foo.com/q/bar/baz/qux</a>&quot;, n=0 would return
            &quot;<a href="http://foo.com/">http://foo.com/</a>&quot;, and n=2 &quot;<a href="http://foo.com/q/bar">http://foo.com/q/bar</a>&quot;.
            
            Returned URL does not include the query string, if any.
            &quot;&quot;&quot;
        
        def dump(self):
            &quot;String representation suitable for debugging output&quot;
            pass
    
        # Possibilities?  I don&#x27;t know if these are worth doing in the 
        # basic objects.
        def getBrowser(self):
            &quot;Returns Mozilla/IE/Lynx/Opera/whatever&quot;
    
        def isSecure(self):
            &quot;Return true if this is an SSLified request&quot;
            

    # Module-level function        
    def wrapper(func, logfile=sys.stderr):
        &quot;&quot;&quot;
        Calls the function &#x27;func&#x27;, passing it the arguments
        (request, response, logfile).  Exceptions are trapped and
        sent to the file &#x27;logfile&#x27;.  
        &quot;&quot;&quot;
        # This wrapper will detect if it&#x27;s being called from the command-line,
        # and if so, it will run in a debugging mode; name=value pairs 
        # can be entered on standard input to set field values.
        # (XXX how to do file uploads in this syntax?)

    
</pre>
<h3>Copyright</h3>
<pre>
    This document has been placed in the public domain.



</pre>
</div>
</body>
</html>
