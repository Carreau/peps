<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<table class="rfc2822 docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">PEP:</th><td class="field-body">514</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Python registration in the Windows registry</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">$Revision$</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference external" href="https://hg.python.org/peps/file/tip/pep-0514.txt">$Date$</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Steve Dower &lt;steve.dower&#32;&#97;t&#32;python.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Informational</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference external" href="/dev/peps/pep-0012">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">02-Feb-2016</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">02-Feb-2016, 01-Mar-2016</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#abstract" id="id2">Abstract</a></li>
<li><a class="reference internal" href="#motivation" id="id3">Motivation</a></li>
<li><a class="reference internal" href="#definitions" id="id4">Definitions</a></li>
<li><a class="reference internal" href="#structure" id="id5">Structure</a><ul>
<li><a class="reference internal" href="#backwards-compatibility" id="id6">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#company" id="id7">Company</a></li>
<li><a class="reference internal" href="#tag" id="id8">Tag</a></li>
<li><a class="reference internal" href="#installpath" id="id9">InstallPath</a></li>
<li><a class="reference internal" href="#help" id="id10">Help</a></li>
<li><a class="reference internal" href="#other-keys" id="id11">Other Keys</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright" id="id12">Copyright</a></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id2">Abstract</a></h1>
<p>This PEP defines a schema for the Python registry key to allow third-party
installers to register their installation, and to allow applications to detect
and correctly display all Python environments on a user's machine. No
implementation changes to Python are proposed with this PEP.</p>
<p>Python environments are not required to be registered unless they want to be
automatically discoverable by external tools.</p>
<p>The schema matches the registry values that have been used by the official
installer since at least Python 2.5, and the resolution behaviour matches the
behaviour of the official Python releases.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id3">Motivation</a></h1>
<p>When installed on Windows, the official Python installer creates a registry key
for discovery and detection by other applications. This allows tools such as
installers or IDEs to automatically detect and display a user's Python
installations.</p>
<p>Third-party installers, such as those used by distributions, typically create
identical keys for the same purpose. Most tools that use the registry to detect
Python installations only inspect the keys used by the official installer. As a
result, third-party installations that wish to be discoverable will overwrite
these values, resulting in users &quot;losing&quot; their Python installation.</p>
<p>By describing a layout for registry keys that allows third-party installations
to register themselves uniquely, as well as providing tool developers guidance
for discovering all available Python installations, these collisions should be
prevented.</p>
</div>
<div class="section" id="definitions">
<h1><a class="toc-backref" href="#id4">Definitions</a></h1>
<p>A &quot;registry key&quot; is the equivalent of a file-system path into the registry. Each
key may contain &quot;subkeys&quot; (keys nested within keys) and &quot;values&quot; (named and
typed attributes attached to a key).</p>
<p><tt class="docutils literal">HKEY_CURRENT_USER</tt> is the root of settings for the currently logged-in user,
and this user can generally read and write all settings under this root.</p>
<p><tt class="docutils literal">HKEY_LOCAL_MACHINE</tt> is the root of settings for all users. Generally, any
user can read these settings but only administrators can modify them. It is
typical for values under <tt class="docutils literal">HKEY_CURRENT_USER</tt> to take precedence over those in
<tt class="docutils literal">HKEY_LOCAL_MACHINE</tt>.</p>
<p>On 64-bit Windows, <tt class="docutils literal">HKEY_LOCAL_MACHINE\Software\Wow6432Node</tt> is a special key
that 32-bit processes transparently read and write to rather than accessing the
<tt class="docutils literal">Software</tt> key directly.</p>
</div>
<div class="section" id="structure">
<h1><a class="toc-backref" href="#id5">Structure</a></h1>
<p>We consider there to be a single collection of Python environments on a machine,
where the collection may be different for each user of the machine. There are
three potential registry locations where the collection may be stored based on
the installation options of each environment:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\&lt;Company&gt;\&lt;Tag&gt;
HKEY_LOCAL_MACHINE\Software\Python\&lt;Company&gt;\&lt;Tag&gt;
HKEY_LOCAL_MACHINE\Software\Wow6432Node\Python\&lt;Company&gt;\&lt;Tag&gt;
</pre>
<p>Environments are uniquely identified by their Company-Tag pair, with two options
for conflict resolution: include everything, or give priority to user
preferences.</p>
<p>Tools that include every installed environment, even where the Company-Tag pairs
match, should ensure users can easily identify whether the registration was
per-user or per-machine.</p>
<p>When tools are selecting a single installed environment from all registered
environments, the intent is that user preferences from <tt class="docutils literal">HKEY_CURRENT_USER</tt>
will override matching Company-Tag pairs in <tt class="docutils literal">HKEY_LOCAL_MACHINE</tt>.</p>
<p>Official Python releases use <tt class="docutils literal">PythonCore</tt> for Company, and the value of
<tt class="docutils literal">sys.winver</tt> for Tag. Other registered environments may use any values for
Company and Tag. Recommendations are made in the following sections.</p>
<p>Python environments are not required to register themselves unless they want to
be automatically discoverable by external tools.</p>
<div class="section" id="backwards-compatibility">
<h2><a class="toc-backref" href="#id6">Backwards Compatibility</a></h2>
<p>Python 3.4 and earlier did not distinguish between 32-bit and 64-bit builds in
<tt class="docutils literal">sys.winver</tt>. As a result, it is possible to have valid side-by-side
installations of both 32-bit and 64-bit interpreters.</p>
<p>To ensure backwards compatibility, applications should treat environments listed
under the following two registry keys as distinct, even when the Tag matches:</p>
<pre class="literal-block">
HKEY_LOCAL_MACHINE\Software\Python\PythonCore\&lt;Tag&gt;
HKEY_LOCAL_MACHINE\Software\Wow6432Node\Python\PythonCore\&lt;Tag&gt;
</pre>
<p>Environments listed under <tt class="docutils literal">HKEY_CURRENT_USER</tt> may be treated as distinct from
both of the above keys, potentially resulting in three environments discovered
using the same Tag. Alternatively, a tool may determine whether the per-user
environment is 64-bit or 32-bit and give it priority over the per-machine
environment, resulting in a maximum of two discovered environments.</p>
<p>It is not possible to detect side-by-side installations of both 64-bit and
32-bit versions of Python prior to 3.5 when they have been installed for the
current user. Python 3.5 and later always uses different Tags for 64-bit and
32-bit versions.</p>
<p>Environments registered under other Company names must use distinct Tags to
support side-by-side installations. Tools consuming these registrations are
not required to disambiguate tags other than by preferring the user's setting.</p>
</div>
<div class="section" id="company">
<h2><a class="toc-backref" href="#id7">Company</a></h2>
<p>The Company part of the key is intended to group related environments and to
ensure that Tags are namespaced appropriately. The key name should be
alphanumeric without spaces and likely to be unique. For example, a trademarked
name, a UUID, or a hostname would be appropriate:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp
HKEY_CURRENT_USER\Software\Python\6C465E66-5A8C-4942-9E6A-D29159480C60
HKEY_CURRENT_USER\Software\Python\www.example.com
</pre>
<p>The company name <tt class="docutils literal">PyLauncher</tt> is reserved for the <a class="reference external" href="/dev/peps/pep-0397">PEP 397</a> launcher
(<tt class="docutils literal">py.exe</tt>). It does not follow this convention and should be ignored by tools.</p>
<p>If a string value named <tt class="docutils literal">DisplayName</tt> exists, it should be used to identify
the environment category to users. Otherwise, the name of the key should be
used.</p>
<p>If a string value named <tt class="docutils literal">SupportUrl</tt> exists, it may be displayed or otherwise
used to direct users to a web site related to the environment.</p>
<p>A complete example may look like:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp
    (Default) = (value not set)
    DisplayName = &quot;Example Corp&quot;
    SupportUrl = &quot;http://www.example.com&quot;
</pre>
</div>
<div class="section" id="tag">
<h2><a class="toc-backref" href="#id8">Tag</a></h2>
<p>The Tag part of the key is intended to uniquely identify an environment within
those provided by a single company. The key name should be alphanumeric without
spaces and stable across installations. For example, the Python language
version, a UUID or a partial/complete hash would be appropriate; an integer
counter that increases for each new environment may not:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp\3.6
HKEY_CURRENT_USER\Software\Python\ExampleCorp\6C465E66
</pre>
<p>If a string value named <tt class="docutils literal">DisplayName</tt> exists, it should be used to identify
the environment to users. Otherwise, the name of the key should be used.</p>
<p>If a string value named <tt class="docutils literal">SupportUrl</tt> exists, it may be displayed or otherwise
used to direct users to a web site related to the environment.</p>
<p>If a string value named <tt class="docutils literal">Version</tt> exists, it should be used to identify the
version of the environment. This is independent from the version of Python
implemented by the environment.</p>
<p>If a string value named <tt class="docutils literal">SysVersion</tt> exists, it must be in <tt class="docutils literal">x.y</tt> or
<tt class="docutils literal">x.y.z</tt> format matching the version returned by <tt class="docutils literal">sys.version_info</tt> in the
interpreter. Otherwise, if the Tag matches this format it is used. If not, the
Python version is unknown.</p>
<p>Note that each of these values is recommended, but optional. A complete example
may look like this:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp\6C465E66
    (Default) = (value not set)
    DisplayName = &quot;Distro 3&quot;
    SupportUrl = &quot;http://www.example.com/distro-3&quot;
    Version = &quot;3.0.12345.0&quot;
    SysVersion = &quot;3.6.0&quot;
</pre>
</div>
<div class="section" id="installpath">
<h2><a class="toc-backref" href="#id9">InstallPath</a></h2>
<p>Beneath the environment key, an <tt class="docutils literal">InstallPath</tt> key must be created. This key is
always named <tt class="docutils literal">InstallPath</tt>, and the default value must match <tt class="docutils literal">sys.prefix</tt>:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp\3.6\InstallPath
    (Default) = &quot;C:\ExampleCorpPy36&quot;
</pre>
<p>If a string value named <tt class="docutils literal">ExecutablePath</tt> exists, it must be a path to the
<tt class="docutils literal">python.exe</tt> (or equivalent) executable. Otherwise, the interpreter executable
is assumed to be called <tt class="docutils literal">python.exe</tt> and exist in the directory referenced by
the default value.</p>
<p>If a string value named <tt class="docutils literal">WindowedExecutablePath</tt> exists, it must be a path to
the <tt class="docutils literal">pythonw.exe</tt> (or equivalent) executable. Otherwise, the windowed
interpreter executable is assumed to be called <tt class="docutils literal">pythonw.exe</tt> and exist in the
directory referenced by the default value.</p>
<p>A complete example may look like:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp\6C465E66\InstallPath
    (Default) = &quot;C:\ExampleDistro30&quot;
    ExecutablePath = &quot;C:\ExampleDistro30\ex_python.exe&quot;
    WindowedExecutablePath = &quot;C:\ExampleDistro30\ex_pythonw.exe&quot;
</pre>
</div>
<div class="section" id="help">
<h2><a class="toc-backref" href="#id10">Help</a></h2>
<p>Beneath the environment key, a <tt class="docutils literal">Help</tt> key may be created. This key is always
named <tt class="docutils literal">Help</tt> if present and has no default value.</p>
<p>Each subkey of <tt class="docutils literal">Help</tt> specifies a documentation file, tool, or URL associated
with the environment. The subkey may have any name, and the default value is a
string appropriate for passing to <tt class="docutils literal">os.startfile</tt> or equivalent.</p>
<p>If a string value named <tt class="docutils literal">DisplayName</tt> exists, it should be used to identify
the help file to users. Otherwise, the key name should be used.</p>
<p>A complete example may look like:</p>
<pre class="literal-block">
HKEY_CURRENT_USER\Software\Python\ExampleCorp\6C465E66\Help
    Python\
        (Default) = &quot;C:\ExampleDistro30\python36.chm&quot;
        DisplayName = &quot;Python Documentation&quot;
    Extras\
        (Default) = &quot;http://www.example.com/tutorial&quot;
        DisplayName = &quot;Example Distro Online Tutorial&quot;
</pre>
</div>
<div class="section" id="other-keys">
<h2><a class="toc-backref" href="#id11">Other Keys</a></h2>
<p>Some other registry keys are used for defining or inferring search paths under
certain conditions. A third-party installation is permitted to define these keys
under their Company-Tag key, however, the interpreter must be modified and
rebuilt in order to read these values. Alternatively, the interpreter may be
modified to not use any registry keys for determining search paths. Making such
changes is a decision for the third party; this PEP makes no recommendation
either way.</p>
</div>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id12">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
</div>

